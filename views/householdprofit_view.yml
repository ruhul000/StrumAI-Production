version: 1
type: view
name: household_profit
description: >-
  The monthly snapshot table with household profit information. To look at this
  data accurately, you must ALWAYS filter for a specific month using the
  data_period_date using the last day of the month. Ask the user to specify the
  period, if they did not initially
model_name: strum_platform_model
sql_table_name: dbo.HouseHoldProfit
default_date: data_period
identifiers:
- name: household
  type: foreign
  sql: concat(${hhid}, ${data_period_raw})
fields:
- name: hhid
  field_type: dimension
  type: number
  hidden: false
  primary_key: false
  description: Household ID
  sql: ${TABLE}.hhid
  searchable: false

- name: hidepbal
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.hidepbal
  searchable: false

- name: depliquid
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.depliquid
  searchable: false

- name: prim_key
  field_type: dimension
  type: string
  hidden: true
  primary_key: true
  sql: concat(${hhid}, ${data_period_raw})

- name: profit
  field_type: dimension
  type: number
  hidden: false
  primary_key: false
  label: HH Profit
  description: >-
    Annualized aggregate profit for all accounts owned by the hh in the prior
    processing period (= 0 for lost hh)
  sql: ${TABLE}.profit
  searchable: false

- name: hhcap
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Aggregate capital for all accounts owned by the household.
  sql: ${TABLE}.hhcap
  searchable: false

- name: cumprofcy
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Stores the total HH profit from all cycles run during the current year
  sql: ${TABLE}.cumprofcy
  searchable: false

- name: cntprofcy
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: 'Stores the total # of profit cycles run for the HH during the current
    year'
  sql: ${TABLE}.cntprofcy
  searchable: false

- name: avgprofit
  field_type: dimension
  type: number
  hidden: false
  primary_key: false
  label: HH Avg Profit
  description: Average HH profit for the current year
  sql: ${TABLE}.avgprofit
  searchable: false

- name: profcat
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    HH profitability category (1 - 4) based on overall distribution of
    households.
  sql: ${TABLE}.profcat
  searchable: false

- name: custseg
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Customer segmentation code based on risk/return profile
  sql: ${TABLE}.custseg
  searchable: false

- name: profpct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: 'HH profitability percentile ranking, valid: 100 (highest) to 0 (lowest).'
  sql: ${TABLE}.profpct
  searchable: false

- name: deppct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: 'HH deposit percentile ranking, valid: 100 (highest) to 0 (lowest).'
  sql: ${TABLE}.deppct
  searchable: false

- name: loanpct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: 'HH loan percentile ranking, valid: 100 (highest) to 0 (lowest).'
  sql: ${TABLE}.loanpct
  searchable: false

- name: hhroe
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Aggregate profit / aggregate capital for all accounts contained in the
    household.
  sql: ${TABLE}.hhroe
  searchable: false

- name: hhvalue
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Amount of value created or destroyed based on HH ROE and institution's
    required rate of return (from GLBLPROF)
  sql: ${TABLE}.hhvalue
  searchable: false

- name: origprof
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Total HH profitability for the period in which the HH is established;
    carried forward each period
  sql: ${TABLE}.origprof
  searchable: false

- name: origacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Total HH accounts owned for the period in which the HH is established;
    carried forward each period (used to calculate lifetime value growth
    index)
  sql: ${TABLE}.origacct
  searchable: false

- name: lifeprof
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Cumulative annual HH profit contribution from start of relationship;
    updated during year-end processing (LifeProf + AvgProfit)
  sql: ${TABLE}.lifeprof
  searchable: false

- name: lvgi
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Creates a normalized index for all HHs to compare cumulative value of the
    relationship from origination.
  sql: ${TABLE}.lvgi
  searchable: false

- name: numacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of accounts owned by the household.
  sql: ${TABLE}.numacct
  searchable: false

- name: numcust
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Number of customers belonging to the household (based on distinct custid
    or tin)
  sql: ${TABLE}.numcust
  searchable: false

- name: numrdacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of retail deposit accounts owned by the hh.
  sql: ${TABLE}.numrdacct
  searchable: false

- name: numrlacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of retail loan accounts owned by the hh.
  sql: ${TABLE}.numrlacct
  searchable: false

- name: numroacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of retail other accounts owned by the hh.
  sql: ${TABLE}.numroacct
  searchable: false

- name: numcdacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of comm. deposit accounts owned by the hh.
  sql: ${TABLE}.numcdacct
  searchable: false

- name: numclacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of comm. loan accounts owned by the hh.
  sql: ${TABLE}.numclacct
  searchable: false

- name: numcoacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of comm. other accounts owned by the hh.
  sql: ${TABLE}.numcoacct
  searchable: false

- name: balrdacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total balance of retail deposit accounts owned by the hh.
  sql: ${TABLE}.balrdacct
  searchable: false

- name: balrlacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total balance of retail loan accounts owned by the hh.
  sql: ${TABLE}.balrlacct
  searchable: false

- name: balroacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total balance of retail other accounts owned by the hh.
  sql: ${TABLE}.balroacct
  searchable: false

- name: balcdacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total balance of comm. deposit accounts owned by the hh.
  sql: ${TABLE}.balcdacct
  searchable: false

- name: balclacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total balance of comm. loan accounts owned by the hh.
  sql: ${TABLE}.balclacct
  searchable: false

- name: balcoacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total balance of comm. other accounts owned by the hh.
  sql: ${TABLE}.balcoacct
  searchable: false

- name: profrdacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total profit from retail deposit accounts owned by the hh.
  sql: ${TABLE}.profrdacct
  searchable: false

- name: profrlacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total profit from retail loan accounts owned by the hh.
  sql: ${TABLE}.profrlacct
  searchable: false

- name: profroacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total profit from retail other accounts owned by the hh.
  sql: ${TABLE}.profroacct
  searchable: false

- name: profcdacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total profit from comm. deposit accounts owned by the hh.
  sql: ${TABLE}.profcdacct
  searchable: false

- name: profclacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total profit from comm. loan accounts owned by the hh.
  sql: ${TABLE}.profclacct
  searchable: false

- name: profcoacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total profit from comm. other accounts owned by the hh.
  sql: ${TABLE}.profcoacct
  searchable: false

- name: hhloaninc
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total HH income from loans
  sql: ${TABLE}.hhloaninc
  searchable: false

- name: hhdepinc
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total HH income from deposits
  sql: ${TABLE}.hhdepinc
  searchable: false

- name: hhothinc
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total HH income from other products
  sql: ${TABLE}.hhothinc
  searchable: false

- name: hhfeeinc
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total HH non-interest income
  sql: ${TABLE}.hhfeeinc
  searchable: false

- name: hhllp
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.hhllp
  searchable: false

- name: hhnie
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total HH non-interest expense
  sql: ${TABLE}.hhnie
  searchable: false

- name: totsvccnt
  field_type: dimension
  type: number
  hidden: false
  primary_key: false
  label: HH Total Services Count
  description: Total number of services (from servgrp table) used by the household.
  sql: ${TABLE}.totsvccnt
  searchable: false

- name: depsvccnt
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Total number of deposit services (from servgrp table) used by the
    household.
  sql: ${TABLE}.depsvccnt
  searchable: false

- name: lnsvccnt
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of loan services (from servgrp table) owned by the household.
  sql: ${TABLE}.lnsvccnt
  searchable: false

- name: othsvccnt
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Total number of other services (from servgrp table) owned by the
    household.
  sql: ${TABLE}.othsvccnt
  searchable: false

- name: cmpsvccnt
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.cmpsvccnt
  searchable: false

- name: hhtottrn
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Total number of core account transactions during the current cycle.
  sql: ${TABLE}.hhtottrn
  searchable: false

- name: pprofit
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Annualized aggregate profit for all accounts owned by the hh in the prior
    processing period (= 0 for lost hh)
  sql: ${TABLE}.pprofit
  searchable: false

- name: pprofcat
  field_type: dimension
  type: number
  hidden: false
  primary_key: false
  description: >-
    Prior HH profitability category (1 - 4) based on overall distribution of
    households.
  sql: ${TABLE}.pprofcat
  searchable: false

- name: pprofpct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Prior period HH profitability percentile, valid: 100 (highest) to 0
    (lowest).
  sql: ${TABLE}.pprofpct
  searchable: false

- name: pnumacct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Prior period number of accounts owned by the household.
  sql: ${TABLE}.pnumacct
  searchable: false

- name: ptotsvccnt
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: >-
    Prior period number of services (from servgrp table) owned by the
    household.
  sql: ${TABLE}.ptotsvccnt
  searchable: false

- name: pcmpsvccnt
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.pcmpsvccnt
  searchable: false

- name: pdeppct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: 'Prior period HH deposit percentile, valid: 100 (highest) to 0 (lowest).'
  sql: ${TABLE}.pdeppct
  searchable: false

- name: ploanpct
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: 'Prior period HH loan percentile, valid: 100 (highest) to 0 (lowest).'
  sql: ${TABLE}.ploanpct
  searchable: false

- name: pdepbal
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.pdepbal
  searchable: false

- name: ploanbal
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.ploanbal
  searchable: false

- name: ptotbal
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: ''
  sql: ${TABLE}.ptotbal
  searchable: false

- name: hiloanbal
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Life-to-date high HH deposit balance
  sql: ${TABLE}.hiloanbal
  searchable: false

- name: hiprofbal
  field_type: dimension
  type: number
  hidden: true
  primary_key: false
  description: Life-to-date high HH profit balance
  sql: ${TABLE}.hiprofbal
  searchable: false

- name: balquad
  field_type: dimension
  type: number
  hidden: false
  primary_key: false
  label: HH Balquad
  description: ''
  sql: ${TABLE}.balquad
  searchable: false

- name: islost
  field_type: dimension
  type: yesno
  hidden: false
  primary_key: false
  label: HH IsLost
  description: ''
  sql: ${TABLE}.islost
  searchable: false

- name: profit_tier
  field_type: dimension
  type: string
  hidden: false
  primary_key: false
  label: Household Profit Category
  description: household profitability category (1 - 4) based on overall distribution
    of households.
  sql: "CASE \r\n    WHEN ${profcat} = 1 THEN '1-Platinum' \r\n    WHEN ${profcat}=
    2 THEN '2-Gold'\r\n    WHEN ${profcat} = 3 THEN '3-Silver' \r\n    WHEN ${profcat}
    = 4 THEN '4-Bronze' \r\n    ELSE NULL END\r\n"
  searchable: true
  synonyms:
  - Profit category

- name: hidepdt
  field_type: dimension_group
  type: time
  datatype: datetime
  hidden: true
  description: Date of highest HH deposit balance
  timeframes:
  - raw
  - date
  - day_of_year
  - week
  - week_of_year
  - month
  - month_of_year
  - quarter
  - year
  sql: ${TABLE}.hidepdt

- name: hiloandt
  field_type: dimension_group
  type: time
  datatype: datetime
  hidden: true
  description: Date of highest HH loan balance
  timeframes:
  - raw
  - date
  - day_of_year
  - week
  - week_of_year
  - month
  - month_of_year
  - quarter
  - year
  sql: ${TABLE}.hiloandt

- name: hiprofdt
  field_type: dimension_group
  type: time
  datatype: datetime
  hidden: true
  description: Date of highest HH profit balance
  timeframes:
  - raw
  - date
  - day_of_year
  - week
  - week_of_year
  - month
  - month_of_year
  - quarter
  - year
  sql: ${TABLE}.hiprofdt

- name: data_period
  field_type: dimension_group
  type: time
  datatype: date
  description: >-
    This is the period of the snapshot, and it is always the date of the end
    of the month
  timeframes:
  - raw
  - date
  - month
  sql: ${TABLE}.DataPeriod
  synonyms:
  - household

- name: created_on
  field_type: dimension_group
  type: time
  datatype: date
  hidden: false
  label: HH Created On
  description: ''
  timeframes:
  - raw
  - date
  - day_of_year
  - month
  - month_of_year
  - year
  sql: ${TABLE}.CreatedOn

- name: updatedon
  field_type: dimension_group
  type: time
  datatype: date
  hidden: true
  timeframes:
  - raw
  - date
  - day_of_year
  - week
  - week_of_year
  - month
  - month_of_year
  - quarter
  - year
  sql: ${TABLE}.UpdatedOn

- name: filedate
  field_type: dimension_group
  type: time
  datatype: date
  hidden: true
  timeframes:
  - raw
  - date
  - day_of_year
  - week
  - week_of_year
  - month
  - month_of_year
  - quarter
  - year
  sql: ${TABLE}.FileDate

- name: total_household_profit
  field_type: measure
  type: sum
  description: The total profit at the household level
  sql: ${profit}

- name: avg_household_profit
  field_type: measure
  type: average
  description: The avg profit at the household level
  sql: ${profit}

- name: total_household
  field_type: measure
  type: count_distinct
  label: Total Households
  description: Total unique number of households
  value_format_name: decimal_0
  sql: case when ${islost}=0 then ${hhid} end
  canon_date: account_profit.data_period

