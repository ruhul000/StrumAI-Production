version: 1
type: view
name: average_account_loan_derived
description: average account loan derived
model_name: strum_platform_model
default_date: data_period
derived_table:
  sql: >-
    SELECT  accounts.DataPeriod, COUNT(DISTINCT accounts.ACCTID) AS
    DistinctAcctCount FROM dbo.Accounts accounts LEFT JOIN dbo.Products Products
    ON accounts.ProductID = Products.ProductID LEFT JOIN dbo.ProdGrp ProdGrp ON
    Products.ProdGrp = ProdGrp.pgrpid LEFT JOIN dbo.ServGrp ServGrp ON
    ProdGrp.sgrpid = ServGrp.sgrpid WHERE ServGrp.bscategory = 2 AND
    accounts.islost = 0 GROUP BY accounts.DataPeriod
fields:
- name: prim_key
  field_type: dimension
  type: string
  hidden: true
  primary_key: true
  sql: concat(${data_period_raw}, ${distinctacctcount})
  searchable: true

- name: distinctacctcount
  field_type: dimension
  type: number
  hidden: true
  label: distinct acct count
  sql: ${TABLE}."DistinctAcctCount"
  searchable: true

- name: data_period
  field_type: dimension_group
  type: time
  datatype: date
  description: >-
    This is the period of the snapshot, and it is always the date of the end
    of the month
  timeframes:
  - raw
  - date
  - month
  sql: ${TABLE}.dataperiod
  synonyms:
  - account

- name: total_distinct_loan_accounts
  field_type: measure
  type: sum
  value_format_name: decimal_0
  sql: ${distinctacctcount}

- name: average_distinct_loan_accounts
  field_type: measure
  type: average
  value_format_name: decimal_0
  sql: ${distinctacctcount}
